// ============================================================================
// ERRORDON MATRIX THEME
// Fediverse-compatible visual overlay
// Does NOT break standard Mastodon functionality
// Opt-in via Ctrl+Shift+M or user settings
// ============================================================================

// Colors (Matrix palette)
$matrix-green: #00ff00;
$matrix-green-dark: #00cc00;
$matrix-green-glow: rgba(0, 255, 0, 0.5);
$matrix-green-subtle: rgba(0, 255, 0, 0.1);
$matrix-black: #000000;
$matrix-dark: #0a0a0a;
$matrix-text: #ffffff;
$matrix-error: #ff0000;

// Hacker Fonts (UTF-8 compatible, fallback to system fonts)
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Fira+Code&display=swap');
$font-hacker: 'VT323', 'Courier New', monospace;
$font-code: 'Fira Code', 'Courier New', monospace;
$font-fallback: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

// Glitch Animation
@keyframes glitch {
  0%, 100% { text-shadow: 2px 0 $matrix-error, -2px 0 cyan; }
  25% { text-shadow: -2px 0 $matrix-error, 2px 0 cyan; }
  50% { text-shadow: 2px 2px $matrix-error, -2px -2px cyan; }
  75% { text-shadow: -2px 2px $matrix-error, 2px -2px cyan; }
}

@keyframes matrix-glow {
  0%, 100% { text-shadow: 0 0 10px $matrix-green, 0 0 20px $matrix-green-glow; }
  50% { text-shadow: 0 0 20px $matrix-green, 0 0 40px $matrix-green-glow; }
}

@keyframes scanline {
  0% { top: -100%; }
  100% { top: 100%; }
}

@keyframes flicker {
  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
  20%, 24%, 55% { opacity: 0.85; }
}

// Glitch Class
.glitch {
  animation: glitch 0.3s infinite;
  &:hover { animation-duration: 0.1s; }
}

.glitch-subtle { animation: flicker 4s infinite; }

// ============================================================================
// BODY & BASE
// Fediverse-compatible: Only visual changes, no structural modifications
// ============================================================================

body.theme-matrix {
  background: $matrix-black;
  color: $matrix-text;
  
  // Subtle scanline effect (purely decorative, doesn't block interaction)
  &::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(transparent, $matrix-green-subtle);
    animation: scanline 6s linear infinite;
    pointer-events: none;
    z-index: 9998; // Below modals and dropdowns
    opacity: 0.5;
  }
}

// ============================================================================
// NAVIGATION & COLUMNS
// ============================================================================

// Fediverse-compatible: Specific selectors, minimal !important
body.theme-matrix {
  .ui, .columns-area, .columns-area__panels {
    background: $matrix-black;
  }

  .column, .drawer {
    background: $matrix-dark;
  }

  .drawer__inner, .drawer__header, .navigation-panel {
    background: $matrix-dark;
    border-right-color: rgba(0, 255, 0, 0.2);
  }

  .column-header {
    background: $matrix-dark;
    border-bottom: 2px solid $matrix-green;
    
    &__title {
      font-family: $font-hacker;
      font-size: 1.4em;
      color: $matrix-green;
      text-shadow: 0 0 10px $matrix-green-glow;
      letter-spacing: 2px;
      animation: matrix-glow 3s ease-in-out infinite;
    }
    
    &__button {
      color: $matrix-green-dark;
      &:hover { color: $matrix-green; }
    }
  }

  .column-back-button {
    background: $matrix-dark;
    color: $matrix-green;
  }
}

// ============================================================================
// COMPOSE FORM
// ============================================================================

body.theme-matrix {
  .compose-form {
    .autosuggest-textarea__textarea,
    .compose-form__autosuggest-wrapper {
      background: $matrix-black;
      border: 1px solid rgba(0, 255, 0, 0.3);
      color: $matrix-text;
      
      &::placeholder { color: $matrix-green-dark; }
      &:focus {
        border-color: $matrix-green;
        box-shadow: 0 0 15px $matrix-green-glow;
      }
    }

    .compose-form__buttons-wrapper {
      background: $matrix-dark;
    }

    .compose-form__publish .button {
      background: $matrix-green;
      color: $matrix-black;
      font-family: $font-hacker;
      
      &:hover {
        background: $matrix-green-dark;
        box-shadow: 0 0 20px $matrix-green-glow;
      }
    }
  }
}

// ============================================================================
// STATUSES / POSTS
// ============================================================================

body.theme-matrix {
  // Posts remain readable - white text on dark
  .status, .detailed-status {
    background: $matrix-dark;
    border-bottom: 1px solid rgba(0, 255, 0, 0.15);
    
    &:hover { background: rgba(0, 255, 0, 0.03); }
  }

  // Content stays white for readability (Fediverse compatible)
  .status__content, .detailed-status__content {
    color: $matrix-text;
    
    a {
      color: $matrix-green;
      &:hover { text-shadow: 0 0 8px $matrix-green-glow; }
    }
  }

  // Usernames in Matrix green
  .display-name {
    &__html {
      font-family: $font-hacker;
      color: $matrix-green;
    }
    &__account {
      color: $matrix-green-dark;
    }
  }

  .status__relative-time, time {
    color: $matrix-green-dark;
  }

  .status__action-bar, .detailed-status__action-bar {
    .icon-button {
      color: $matrix-green-dark;
      &:hover, &.active { color: $matrix-green; }
    }
  }
}

// ============================================================================
// MEDIA (Video, Audio, Images)
// ============================================================================

body.theme-matrix {
  .media-gallery {
    border: 1px solid rgba(0, 255, 0, 0.3);
    &:hover { box-shadow: 0 0 15px $matrix-green-glow; }
  }

  // Keep media visible and functional
  .media-gallery__item-thumbnail {
    filter: saturate(0.8) brightness(0.9);
    &:hover { filter: saturate(1) brightness(1); }
  }

  .video-player {
    border: 2px solid $matrix-green;
    box-shadow: 0 0 10px $matrix-green-glow;
    
    .video-player__controls { background: rgba(0, 0, 0, 0.85); }
    .video-player__seek::before,
    .video-player__volume::before { background: $matrix-green; }
  }

  .audio-player {
    background: $matrix-dark;
    border: 2px solid $matrix-green;
    
    .audio-player__progress { background: $matrix-green; }
  }
}

// ============================================================================
// ACCOUNTS & PROFILES
// ============================================================================

body.theme-matrix {
  .account, .account-card {
    background: $matrix-dark;
    border: 1px solid rgba(0, 255, 0, 0.2);
    &:hover { border-color: $matrix-green; }
  }

  .account__header {
    background: linear-gradient($matrix-dark, $matrix-black);
    
    &__image {
      // Subtle effect, keeps images visible
      filter: grayscale(20%) contrast(1.05);
    }
    
    &__bar { background: $matrix-dark; }
    
    &__tabs__name h1 {
      font-family: $font-hacker;
      color: $matrix-green;
      text-shadow: 0 0 15px $matrix-green-glow;
      
      small {
        color: $matrix-green-dark;
      }
    }
    
    &__bio { color: $matrix-text; }
    
    &__fields {
      border-color: rgba(0, 255, 0, 0.2);
      dt { color: $matrix-green; }
      dd { color: $matrix-text; }
    }
  }
}

// ============================================================================
// NOTIFICATIONS
// ============================================================================

body.theme-matrix {
  .notification {
    border-bottom: 1px solid rgba(0, 255, 0, 0.15);
    
    &__message {
      color: $matrix-green;
    }
  }
}

// ============================================================================
// MODALS
// ============================================================================

body.theme-matrix {
  .modal-root__overlay { background: rgba(0, 0, 0, 0.92); }

  .modal-root__container {
    .compose-modal,
    .confirmation-modal,
    .report-modal,
    .mute-modal,
    .block-modal,
    .boost-modal {
      background: $matrix-dark;
      border: 2px solid $matrix-green;
      box-shadow: 0 0 40px $matrix-green-glow;
    }

    .confirmation-modal__action-bar,
    .mute-modal__action-bar,
    .boost-modal__action-bar {
      background: $matrix-black;
    }
  }
}

// ============================================================================
// BUTTONS
// ============================================================================

body.theme-matrix {
  .button {
    background: $matrix-green;
    color: $matrix-black;
    font-family: $font-hacker;
    font-weight: bold;
    letter-spacing: 1px;
    
    &:hover {
      background: $matrix-green-dark;
      box-shadow: 0 0 15px $matrix-green-glow;
    }
    
    &--destructive {
      background: $matrix-error;
      &:hover { box-shadow: 0 0 15px rgba(255, 0, 0, 0.5); }
    }
  }

  .icon-button {
    color: $matrix-green-dark;
    &:hover, &.active { color: $matrix-green; }
  }
}

// ============================================================================
// SCROLLBARS
// ============================================================================

body.theme-matrix {
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: $matrix-black; }
  ::-webkit-scrollbar-thumb {
    background: $matrix-green-dark;
    border-radius: 4px;
    &:hover { background: $matrix-green; }
  }
}

// ============================================================================
// SEARCH & INPUTS
// ============================================================================

body.theme-matrix {
  .search__input,
  .setting-text,
  input[type="text"],
  input[type="email"],
  input[type="password"],
  textarea {
    background: $matrix-black;
    border: 1px solid rgba(0, 255, 0, 0.3);
    color: $matrix-text;
    
    &::placeholder { color: $matrix-green-dark; }
    &:focus {
      border-color: $matrix-green;
      box-shadow: 0 0 10px $matrix-green-glow;
    }
  }
}

// ============================================================================
// GLITCH HEADINGS (hover effect)
// ============================================================================

body.theme-matrix {
  // Glitch effect on hover (purely visual)
  .column-header__title:hover,
  .account__header__tabs__name h1:hover {
    animation: glitch 0.2s ease;
  }
}

// ============================================================================
// TABS & NAVIGATION ITEMS
// ============================================================================

body.theme-matrix {
  .tabs-bar__link,
  .column-link {
    color: $matrix-green-dark;
    
    &:hover, &.active {
      color: $matrix-green;
      background: rgba(0, 255, 0, 0.1);
    }
    
    &.active {
      border-bottom-color: $matrix-green;
    }
  }
}

// ============================================================================
// LOADING & EMPTY STATES
// ============================================================================

body.theme-matrix {
  .loading-indicator {
    .loading-indicator__figure {
      border-color: $matrix-green transparent;
    }
  }

  .empty-column-indicator,
  .error-column {
    color: $matrix-green-dark;
  }
}

// ============================================================================
// MATRIX RAIN BACKGROUND CANVAS
// ============================================================================

// Matrix Rain Canvas - fixed background behind everything
.matrix-rain-canvas {
  position: fixed !important;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;
  pointer-events: none;
}

// When Matrix theme active, make body transparent
body.theme-matrix {
  background: transparent !important;
  
  // Main UI containers semi-transparent to show rain through
  .ui {
    background: transparent !important;
  }
  
  .columns-area {
    background: transparent !important;
  }
  
  .columns-area__panels {
    background: transparent !important;
  }
  
  // Columns get dark overlay - rain shows through slightly
  .column,
  .drawer {
    background: rgba(0, 0, 0, 0.88) !important;
    backdrop-filter: blur(1px);
  }
  
  .drawer__inner {
    background: rgba(0, 0, 0, 0.88) !important;
  }
  
  // Posts semi-transparent - rain visible behind
  .status,
  .detailed-status {
    background: rgba(0, 0, 0, 0.85) !important;
  }
  
  // Navigation panel
  .navigation-panel {
    background: rgba(0, 0, 0, 0.9) !important;
  }
}

// ============================================================================
// MATRIX SPLASH SCREEN (Enter Matrix)
// ============================================================================

.matrix-splash-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 99999;
  display: flex;
  align-items: center;
  justify-content: center;
  background: $matrix-black;

  &.matrix-fade-out {
    animation: matrixFadeOut 1s ease-out forwards;
  }

  &.matrix-glitch {
    animation: matrixGlitchScreen 0.3s ease-in-out;
  }
}

.splash-matrix-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.matrix-splash-content {
  position: relative;
  z-index: 10;
  text-align: center;
  padding: 60px;
  background: rgba(0, 0, 0, 0.95);
  border: 2px solid $matrix-green;
  border-radius: 10px;
  box-shadow: 0 0 50px $matrix-green-glow;
}

.matrix-splash-title {
  color: $matrix-green;
  font-family: $font-hacker;
  font-size: 56px;
  font-weight: bold;
  text-shadow: 0 0 30px $matrix-green;
  letter-spacing: 10px;
  margin-bottom: 20px;
  animation: matrix-glow 2s ease-in-out infinite;
}

.matrix-splash-subtitle {
  color: $matrix-green-dark;
  font-family: $font-hacker;
  font-size: 20px;
  margin-bottom: 40px;
  letter-spacing: 3px;
}

.matrix-splash-terminal {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 30px;
}

.matrix-prompt {
  color: $matrix-green;
  font-family: $font-code;
  font-weight: bold;
  font-size: 18px;
}

.matrix-splash-input {
  background: transparent;
  border: none;
  border-bottom: 2px solid $matrix-green;
  color: $matrix-green;
  font-family: $font-code;
  font-size: 18px;
  padding: 12px 15px;
  width: 350px;
  outline: none;
  letter-spacing: 1px;

  &::placeholder {
    color: rgba(0, 255, 0, 0.4);
    font-style: italic;
  }

  &:focus {
    box-shadow: 0 4px 15px $matrix-green-glow;
  }
}

.matrix-splash-hint {
  color: $matrix-green-dark;
  font-family: $font-hacker;
  font-size: 16px;
  font-style: italic;
  animation: matrixBlink 2s ease-in-out infinite;
}

// Splash Animations
@keyframes matrixFadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; visibility: hidden; }
}

@keyframes matrixGlitchScreen {
  0%, 100% { transform: translate(0); filter: none; }
  20% { transform: translate(-5px, 5px); filter: hue-rotate(90deg); }
  40% { transform: translate(5px, -5px); filter: hue-rotate(180deg); }
  60% { transform: translate(-3px, 3px); filter: hue-rotate(270deg); }
  80% { transform: translate(3px, -3px); filter: hue-rotate(360deg); }
}

@keyframes matrixBlink {
  0%, 50%, 100% { opacity: 1; }
  25%, 75% { opacity: 0.3; }
}

.matrix-glitch-text {
  animation: matrixTextGlitch 0.5s ease-in-out infinite;
}

@keyframes matrixTextGlitch {
  0%, 100% { 
    text-shadow: 0 0 20px $matrix-green;
    transform: translate(0);
  }
  25% { 
    text-shadow: -3px 0 #ff0000, 3px 0 #00ffff;
    transform: translate(2px, -1px);
  }
  50% { 
    text-shadow: 3px 0 #ff0000, -3px 0 #00ffff;
    transform: translate(-2px, 1px);
  }
  75% { 
    text-shadow: 0 0 20px $matrix-green;
    transform: translate(1px, 2px);
  }
}
