// ============================================================================
// ERRORDON MATRIX THEME
// Fediverse-compatible visual overlay
// Does NOT break standard Mastodon functionality
// Opt-in via Ctrl+Shift+M or user settings
// ============================================================================

// Colors (Matrix palette)
$matrix-green: #00ff00;
$matrix-green-dark: #00cc00;
$matrix-green-glow: rgba(0, 255, 0, 0.5);
$matrix-green-subtle: rgba(0, 255, 0, 0.1);
$matrix-black: #000000;
$matrix-dark: #0a0a0a;
$matrix-text: #ffffff;
$matrix-error: #ff0000;

// Hacker Fonts (UTF-8 compatible, fallback to system fonts)
@import url('https://fonts.googleapis.com/css2?family=VT323&family=Fira+Code&display=swap');
$font-hacker: 'VT323', 'Courier New', monospace;
$font-code: 'Fira Code', 'Courier New', monospace;
$font-fallback: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

// Glitch Animation
@keyframes glitch {
  0%, 100% { text-shadow: 2px 0 $matrix-error, -2px 0 cyan; }
  25% { text-shadow: -2px 0 $matrix-error, 2px 0 cyan; }
  50% { text-shadow: 2px 2px $matrix-error, -2px -2px cyan; }
  75% { text-shadow: -2px 2px $matrix-error, 2px -2px cyan; }
}

@keyframes matrix-glow {
  0%, 100% { text-shadow: 0 0 10px $matrix-green, 0 0 20px $matrix-green-glow; }
  50% { text-shadow: 0 0 20px $matrix-green, 0 0 40px $matrix-green-glow; }
}

@keyframes scanline {
  0% { top: -100%; }
  100% { top: 100%; }
}

@keyframes flicker {
  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
  20%, 24%, 55% { opacity: 0.85; }
}

// Glitch Class
.glitch {
  animation: glitch 0.3s infinite;
  &:hover { animation-duration: 0.1s; }
}

.glitch-subtle { animation: flicker 4s infinite; }

// ============================================================================
// BODY & BASE
// Fediverse-compatible: Only visual changes, no structural modifications
// ============================================================================

body.theme-matrix {
  background: $matrix-black;
  color: $matrix-text;
  
  // Subtle scanline effect (purely decorative, doesn't block interaction)
  &::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(transparent, $matrix-green-subtle);
    animation: scanline 6s linear infinite;
    pointer-events: none;
    z-index: 9998; // Below modals and dropdowns
    opacity: 0.5;
  }
}

// ============================================================================
// NAVIGATION & COLUMNS
// ============================================================================

// Fediverse-compatible: Specific selectors, minimal !important
body.theme-matrix {
  .ui, .columns-area, .columns-area__panels {
    background: $matrix-black;
  }

  .column, .drawer {
    background: $matrix-dark;
  }

  .drawer__inner, .drawer__header, .navigation-panel {
    background: $matrix-dark;
    border-right-color: rgba(0, 255, 0, 0.2);
  }

  .column-header {
    background: $matrix-dark;
    border-bottom: 2px solid $matrix-green;
    
    &__title {
      font-family: $font-hacker;
      font-size: 1.4em;
      color: $matrix-green;
      text-shadow: 0 0 10px $matrix-green-glow;
      letter-spacing: 2px;
      animation: matrix-glow 3s ease-in-out infinite;
    }
    
    &__button {
      color: $matrix-green-dark;
      &:hover { color: $matrix-green; }
    }
  }

  .column-back-button {
    background: $matrix-dark;
    color: $matrix-green;
  }
}

// ============================================================================
// COMPOSE FORM
// ============================================================================

body.theme-matrix {
  .compose-form {
    .autosuggest-textarea__textarea,
    .compose-form__autosuggest-wrapper {
      background: $matrix-black;
      border: 1px solid rgba(0, 255, 0, 0.3);
      color: $matrix-text;
      
      &::placeholder { color: $matrix-green-dark; }
      &:focus {
        border-color: $matrix-green;
        box-shadow: 0 0 15px $matrix-green-glow;
      }
    }

    .compose-form__buttons-wrapper {
      background: $matrix-dark;
    }

    .compose-form__publish .button {
      background: $matrix-green;
      color: $matrix-black;
      font-family: $font-hacker;
      
      &:hover {
        background: $matrix-green-dark;
        box-shadow: 0 0 20px $matrix-green-glow;
      }
    }
  }
}

// ============================================================================
// STATUSES / POSTS
// ============================================================================

body.theme-matrix {
  // Posts remain readable - white text on dark
  .status, .detailed-status {
    background: $matrix-dark;
    border-bottom: 1px solid rgba(0, 255, 0, 0.15);
    
    &:hover { background: rgba(0, 255, 0, 0.03); }
  }

  // Content stays white for readability (Fediverse compatible)
  .status__content, .detailed-status__content {
    color: $matrix-text;
    
    a {
      color: $matrix-green;
      &:hover { text-shadow: 0 0 8px $matrix-green-glow; }
    }
  }

  // Usernames in Matrix green
  .display-name {
    &__html {
      font-family: $font-hacker;
      color: $matrix-green;
    }
    &__account {
      color: $matrix-green-dark;
    }
  }

  .status__relative-time, time {
    color: $matrix-green-dark;
  }

  .status__action-bar, .detailed-status__action-bar {
    .icon-button {
      color: $matrix-green-dark;
      &:hover, &.active { color: $matrix-green; }
    }
  }
}

// ============================================================================
// MEDIA (Video, Audio, Images)
// ============================================================================

body.theme-matrix {
  .media-gallery {
    border: 1px solid rgba(0, 255, 0, 0.3);
    &:hover { box-shadow: 0 0 15px $matrix-green-glow; }
  }

  // Keep media visible and functional
  .media-gallery__item-thumbnail {
    filter: saturate(0.8) brightness(0.9);
    &:hover { filter: saturate(1) brightness(1); }
  }

  .video-player {
    border: 2px solid $matrix-green;
    box-shadow: 0 0 10px $matrix-green-glow;
    
    .video-player__controls { background: rgba(0, 0, 0, 0.85); }
    .video-player__seek::before,
    .video-player__volume::before { background: $matrix-green; }
  }

  .audio-player {
    background: $matrix-dark;
    border: 2px solid $matrix-green;
    
    .audio-player__progress { background: $matrix-green; }
  }
}

// ============================================================================
// ACCOUNTS & PROFILES
// ============================================================================

body.theme-matrix {
  .account, .account-card {
    background: $matrix-dark;
    border: 1px solid rgba(0, 255, 0, 0.2);
    &:hover { border-color: $matrix-green; }
  }

  .account__header {
    background: linear-gradient($matrix-dark, $matrix-black);
    
    &__image {
      // Subtle effect, keeps images visible
      filter: grayscale(20%) contrast(1.05);
    }
    
    &__bar { background: $matrix-dark; }
    
    &__tabs__name h1 {
      font-family: $font-hacker;
      color: $matrix-green;
      text-shadow: 0 0 15px $matrix-green-glow;
      
      small {
        color: $matrix-green-dark;
      }
    }
    
    &__bio { color: $matrix-text; }
    
    &__fields {
      border-color: rgba(0, 255, 0, 0.2);
      dt { color: $matrix-green; }
      dd { color: $matrix-text; }
    }
  }
}

// ============================================================================
// NOTIFICATIONS
// ============================================================================

body.theme-matrix {
  .notification {
    border-bottom: 1px solid rgba(0, 255, 0, 0.15);
    
    &__message {
      color: $matrix-green;
    }
  }
}

// ============================================================================
// MODALS
// ============================================================================

body.theme-matrix {
  .modal-root__overlay { background: rgba(0, 0, 0, 0.92); }

  .modal-root__container {
    .compose-modal,
    .confirmation-modal,
    .report-modal,
    .mute-modal,
    .block-modal,
    .boost-modal {
      background: $matrix-dark;
      border: 2px solid $matrix-green;
      box-shadow: 0 0 40px $matrix-green-glow;
    }

    .confirmation-modal__action-bar,
    .mute-modal__action-bar,
    .boost-modal__action-bar {
      background: $matrix-black;
    }
  }
}

// ============================================================================
// BUTTONS
// ============================================================================

body.theme-matrix {
  .button {
    background: $matrix-green;
    color: $matrix-black;
    font-family: $font-hacker;
    font-weight: bold;
    letter-spacing: 1px;
    
    &:hover {
      background: $matrix-green-dark;
      box-shadow: 0 0 15px $matrix-green-glow;
    }
    
    &--destructive {
      background: $matrix-error;
      &:hover { box-shadow: 0 0 15px rgba(255, 0, 0, 0.5); }
    }
  }

  .icon-button {
    color: $matrix-green-dark;
    &:hover, &.active { color: $matrix-green; }
  }
}

// ============================================================================
// SCROLLBARS
// ============================================================================

body.theme-matrix {
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: $matrix-black; }
  ::-webkit-scrollbar-thumb {
    background: $matrix-green-dark;
    border-radius: 4px;
    &:hover { background: $matrix-green; }
  }
}

// ============================================================================
// SEARCH & INPUTS
// ============================================================================

body.theme-matrix {
  .search__input,
  .setting-text,
  input[type="text"],
  input[type="email"],
  input[type="password"],
  textarea {
    background: $matrix-black;
    border: 1px solid rgba(0, 255, 0, 0.3);
    color: $matrix-text;
    
    &::placeholder { color: $matrix-green-dark; }
    &:focus {
      border-color: $matrix-green;
      box-shadow: 0 0 10px $matrix-green-glow;
    }
  }
}

// ============================================================================
// GLITCH HEADINGS (hover effect)
// ============================================================================

body.theme-matrix {
  // Glitch effect on hover (purely visual)
  .column-header__title:hover,
  .account__header__tabs__name h1:hover {
    animation: glitch 0.2s ease;
  }
}

// ============================================================================
// TABS & NAVIGATION ITEMS
// ============================================================================

body.theme-matrix {
  .tabs-bar__link,
  .column-link {
    color: $matrix-green-dark;
    
    &:hover, &.active {
      color: $matrix-green;
      background: rgba(0, 255, 0, 0.1);
    }
    
    &.active {
      border-bottom-color: $matrix-green;
    }
  }
}

// ============================================================================
// LOADING & EMPTY STATES
// ============================================================================

body.theme-matrix {
  .loading-indicator {
    .loading-indicator__figure {
      border-color: $matrix-green transparent;
    }
  }

  .empty-column-indicator,
  .error-column {
    color: $matrix-green-dark;
  }
}
